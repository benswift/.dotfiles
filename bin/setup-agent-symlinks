#!/usr/bin/env bash

set -euo pipefail

# Find repo root (prefer jj, fall back to git)
if repo_root=$(jj root 2>/dev/null); then
    :
elif repo_root=$(git rev-parse --show-toplevel 2>/dev/null); then
    :
else
    echo "Error: not in a jj or git repository"
    exit 1
fi

# Check if AGENTS.md exists
if [[ ! -f "$repo_root/AGENTS.md" ]]; then
    echo "No AGENTS.md file found in repo root: $repo_root"
    exit 0
fi

# Create symlinks
ln -sfn "$repo_root/AGENTS.md" "$repo_root/CLAUDE.md"
echo "Created symlink: $repo_root/CLAUDE.md -> AGENTS.md"

ln -sfn "$repo_root/AGENTS.md" "$repo_root/codex.md"
echo "Created symlink: $repo_root/codex.md -> AGENTS.md"
